const yamlEditor=window.ace.edit("yaml-editor"),jsonEditor=window.ace.edit("json-editor");yamlEditor.setValue("# loading..",-1),jsonEditor.setValue('{ "status": "loading.." }',-1),yamlEditor.setOptions({fontSize:"12pt"}),jsonEditor.setOptions({fontSize:"12pt"}),yamlEditor.getSession().setMode("ace/mode/yaml"),jsonEditor.getSession().setMode("ace/mode/json"),window.ace.config.loadModule("ace/ext/searchbox",(t=>{t.Search(jsonEditor),t.Search(yamlEditor)})),yamlEditor.searchBox.hide(),jsonEditor.searchBox.hide(),yamlEditor.getSession().setUseWrapMode(!0),jsonEditor.getSession().setUseWrapMode(!0);class StatusControl{onAdd(t){return this.map=t,this.container=document.createElement("div"),this.container.className="status-control",this.container.textContent="JSON Content: loading",this.container}onRemove(){this.container.parentNode.removeChild(this.container),this.map=void 0}update(t){this.container.textContent=`JSON Content: ${t}`}}class ForkMeControl{constructor(t){this.url=t.url}onAdd(){return this.container=document.createElement("div"),this.container.className="mapboxgl-ctrl",this.container.innerHTML='<a><img style="position: absolute; top: -159px; left: -10px; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png" alt="Fork me on GitHub"></a>',this.container.querySelector("a").href=this.url,document.querySelector(".mapboxgl-ctrl-top-left").style.top="149px",this.container}onRemove(){this.container.parentNode.removeChild(this.container)}getDefaultPosition(){return"top-left"}}const fetchYaml=async()=>{let t;const e=new URLSearchParams(location.search).get("style");if(!e){const t=await fetch("./style.yml").then((t=>t.text()));return{yaml:t,json:new window.VT.Transpiler(t).toText()}}if(e)if(e.match(/^https:\/\//))t=e;else{const o=e.split(/\//).filter((t=>!!t));1===o.length?(o.unshift("geolonia"),o.push("master")):2===o.length&&o.push("master"),t="https://raw.githubusercontent.com/%s/style.json".replace("%s",o.join("/"))}if(t.includes("/master/style.json")&&(await fetch(t,{method:"HEAD"})).status>399){const e=t.replace("/master/style.json","/main/style.json");console.log(`[geolonia/preview] style ${t} is not found. Trying ${e}..`),t=e}const o=await fetch(t).then((t=>t.text()));return{yaml:window.VT.Transpiler._json2yaml(o),json:o}},main=async()=>{window.Split(["#left-pane","#right-pane"],{direction:"horizontal",onDragEnd:()=>{s.resize(),yamlEditor.resize(),jsonEditor.resize()}}),window.Split(["#right-top-pane","#right-bottom-pane"],{direction:"vertical",onDragEnd:()=>{s.resize(),jsonEditor.resize()}});const t=new StatusControl,e=new ForkMeControl({url:"https://github.com/geolonia/vt-style"}),{yaml:o,json:n}=await fetchYaml();console.log({json:n});const s=new window.geolonia.Map({container:"#map",style:JSON.parse(n)});yamlEditor.resize(),jsonEditor.resize(),s.on("load",(()=>{s.addControl(t,"bottom-right"),s.addControl(e,"top-left"),jsonEditor.unsetStyle("feature-mode"),jsonEditor.setStyle("style-mode"),t.update("style"),yamlEditor.session.on("change",(()=>{const e=yamlEditor.getValue();try{const o=new window.VT.Transpiler(e).toJSON();s.setStyle(o),jsonEditor.setValue(JSON.stringify(o,null,2),-1),t.update("style"),jsonEditor.unsetStyle("feature-mode"),jsonEditor.setStyle("style-mode")}catch(t){console.error(t)}})),s.on("click",(e=>{const o=s.queryRenderedFeatures(e.point);jsonEditor.setValue(JSON.stringify(o,null,2),-1),t.update(`features(${o.length})`),jsonEditor.unsetStyle("style-mode"),jsonEditor.setStyle("feature-mode")}))})),yamlEditor.setValue(o,-1),jsonEditor.setValue(n,-1)};main();